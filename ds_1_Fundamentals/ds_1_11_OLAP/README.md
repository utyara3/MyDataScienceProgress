# OLAP (Online Analytic Processing)

## Определение
**OLAP** - технология многомерного анализа данных, ориентированная на сложные аналитические запросы и агрегацию больших объемов информации.

## Ключевая идея
OLAP позволяет аналитикам смотреть на данные с разных точек зрения ("разрезать" и "нарезать" данные.)

## OLAP vs OLTP

### OLTP (Online Transaction Processing)
- **Назначение**: Операционная обработка транзакций
- **Примеры**: Интернет-магазин, банковские операции
- **Типы запросов**: 
  - "Добавить новый заказ"
  - "Обновить баланс счета"
  - "Найти пользователя по ID"
- **Характеристики**:
  - Много коротких запросов
  - Частые записи
  - Текущие данные
  - Нормализованная схема

### OLAP (Online Analytical Processing)
- **Назначение**: Аналитическая обработка, отчетность
- **Примеры**: Business Intelligence, аналитические дашборды
- **Типы запросов**:
  - "Продажи по регионам за последний год"
  - "Сравнение выручки по кварталам"
  - "Топ-10 товаров по прибыльности"
- **Характеристики**:
  - Мало сложных запросов
  - В основном чтение
  - Исторические данные
  - Денормализованная схема

## Ключевые концепции OLAP

### 1. Куб данных (Data Cube)

Куб представляет данные в трех и более измерениях:
- **Измерения (Dimensions)**: Продукт, Время, Регион (как мы смотрим на данные)
- **Меры (Measures)**: Продажи, Профит (что мы измеряем)

### 2. Операции OLAP

#### Slice (Срез)
Выбор одного "среза" куба по измерению:
- "Продажи всех товаров в Москве в январе"

#### Dice (Вырезка)
Выбор подмножества по нескольким измерениям:
- "Продажи электроники в Москве и СПб в Q1"

#### Drill-Down/Up (Детализация/Агрегация)
- **Drill-Down**: от годовых → квартальным → месячным данным
- **Roll-Up**: от дневных → недельным → месячным данным

#### Pivot (Поворот)
Изменение ориентации представления:
- Строки: продукты, столбцы: месяцы → строки: месяцы, столбцы: продукты

## Типы OLAP систем

### 1. MOLAP (Multidimensional OLAP)
- Хранит данные в специализированных многомерных базах
- **Плюсы**: высокая производительность
- **Минусы**: ограниченный объем данных

### 2. ROLAP (Relational OLAP)
- Использует реляционные БД с звездообразной схемой
- **Плюсы**: большие объемы данных
- **Минусы**: медленнее чем MOLAP

### 3. HOLAP (Hybrid OLAP)
- Комбинация MOLAP и ROLAP
- Детальные данные в RDBMS, агрегаты в MOLAP

## Звездообразная схема (Star Schema)

### Компоненты:

### Fact Table (Таблица фактов):
- Ключи измерений (foreign keys)
- Меры (числовые значения для анализа)
- Пример: `sales_fact` (date_id, product_id, region_id, sales_amount, quantity)

### Dimension Tables (Таблицы измерений):
- Описательные атрибуты
- Пример: `dim_product` (product_id, product_name, category, brand)

## Пример SQL запроса OLAP

```sql
-- Анализ продаж по категориям и кварталам
SELECT 
    p.category,
    d.quarter,
    SUM(f.sales_amount) as total_sales,
    AVG(f.profit) as avg_profit
FROM sales_fact f
JOIN dim_product p ON f.product_id = p.product_id
JOIN dim_date d ON f.date_id = d.date_id
WHERE d.year = 2024
GROUP BY p.category, d.quarter
ORDER BY total_sales DESC;
```